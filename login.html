<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Visionly - Login</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
</head>
<body style="font-family: 'Inter', sans-serif; background-color: #f5f5f5; margin: 0; padding: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center;">
    <div style="background: white; border-radius: 12px; box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1); width: 100%; max-width: 400px; overflow: hidden;">
        <!-- Header Image -->
        <div style="height: 180px; background: linear-gradient(135deg, #e8d5b0 0%, #d4c4a0 100%); position: relative;">
            <div style="position: absolute; inset: 0; background: url('assets/login-bg.jpg') center center / cover no-repeat; opacity: 0.3;"></div>
        </div>
        
        <!-- Login Form -->
        <div style="padding: 32px;">
            <h2 style="text-align: center; margin: 0 0 24px 0; font-size: 1.5rem; font-weight: 600; color: #333;">Welcome to Visionly</h2>
            
            <form id="auth-form">
                <div style="margin-bottom: 16px;">
                    <input type="email" id="email" placeholder="Email" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                </div>
                
                <div style="margin-bottom: 16px;">
                    <input type="password" id="password" placeholder="Password" required style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
                </div>
                
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <input type="checkbox" id="remember" style="margin-right: 8px;">
                    <label for="remember" style="font-size: 14px; color: #666;">Remember me</label>
                </div>
                
                <a href="#" id="forgot-password" style="display: block; text-align: center; color: #6b46c1; text-decoration: none; font-size: 14px; margin-bottom: 20px;">Forgot Password?</a>
                
                <button type="submit" id="login-btn" style="width: 100%; background: #4a90e2; color: white; padding: 12px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-bottom: 16px;">Login</button>
                
                <div style="text-align: center; margin: 20px 0; color: #999; font-size: 14px;">Or continue with</div>
                
                <button type="button" id="google-login" style="width: 100%; background: #f8f9fa; color: #333; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; cursor: pointer; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" style="width: 16px; height: 16px;">
                    Continue with SearchEngine/Co
                </button>
                
                <div style="text-align: center; margin-top: 20px;">
                    <span style="color: #666; font-size: 14px;">Don't have an account? </span>
                    <a href="#" id="signup-link" style="color: #6b46c1; text-decoration: none; font-weight: 600;">Sign up</a>
                </div>
            </form>
            
            <!-- Error/Success Messages -->
            <div id="message" style="margin-top: 16px; padding: 12px; border-radius: 6px; text-align: center; font-size: 14px; display: none;"></div>
        </div>
    </div>

    <script>
        // Firebase configuration - Updated with your actual API key
        const firebaseConfig = {
            apiKey: "AIzaSyDs9_aRBzltPKNU3i8uZxoyaGiBZSoPb5s",
            authDomain: "visionly-442105.firebaseapp.com",
            projectId: "visionly-442105",
            storageBucket: "visionly-442105.firebasestorage.app",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // DOM elements
        const authForm = document.getElementById('auth-form');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('login-btn');
        const signupLink = document.getElementById('signup-link');
        const forgotPasswordLink = document.getElementById('forgot-password');
        const googleLoginBtn = document.getElementById('google-login');
        const messageDiv = document.getElementById('message');

        let isSignupMode = false;

        // Show message
        function showMessage(text, isError = false) {
            messageDiv.textContent = text;
            messageDiv.style.display = 'block';
            messageDiv.style.backgroundColor = isError ? '#fee' : '#efe';
            messageDiv.style.color = isError ? '#c33' : '#363';
            messageDiv.style.border = `1px solid ${isError ? '#fcc' : '#cfc'}`;
        }

        // Hide message
        function hideMessage() {
            messageDiv.style.display = 'none';
        }

        // Toggle between login and signup
        function toggleMode() {
            isSignupMode = !isSignupMode;
            if (isSignupMode) {
                loginBtn.textContent = 'Sign Up';
                signupLink.innerHTML = '<span style="color: #666;">Already have an account? </span><span style="color: #6b46c1;">Login</span>';
                document.querySelector('h2').textContent = 'Create Account';
            } else {
                loginBtn.textContent = 'Login';
                signupLink.innerHTML = '<span style="color: #666;">Don\'t have an account? </span><span style="color: #6b46c1;">Sign up</span>';
                document.querySelector('h2').textContent = 'Welcome to Visionly';
            }
            hideMessage();
        }

        // Event listeners
        signupLink.addEventListener('click', function(e) {
            e.preventDefault();
            toggleMode();
        });

        // Form submission
        authForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = emailInput.value.trim();
            const password = passwordInput.value;

            if (!email || !password) {
                showMessage('Please fill in all fields', true);
                return;
            }

            loginBtn.disabled = true;
            loginBtn.textContent = isSignupMode ? 'Creating Account...' : 'Logging in...';

            try {
                if (isSignupMode) {
                    // Sign up
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    showMessage('Account created successfully! Redirecting...');
                    
                    // Store user data in Firestore
                    const user = userCredential.user;
                    await firebase.firestore().collection('users').doc(user.uid).set({
                        email: user.email,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    // Login
                    await auth.signInWithEmailAndPassword(email, password);
                    showMessage('Login successful! Redirecting...');
                    
                    // Update last login
                    const user = auth.currentUser;
                    if (user) {
                        await firebase.firestore().collection('users').doc(user.uid).update({
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                }
                
                // Redirect to main page after successful auth
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);

            } catch (error) {
                console.error('Auth error:', error);
                let errorMessage = 'Authentication failed';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'No account found with this email';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Incorrect password';
                        break;
                    case 'auth/email-already-in-use':
                        errorMessage = 'Email already registered';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password should be at least 6 characters';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Too many failed attempts. Try again later.';
                        break;
                }
                
                showMessage(errorMessage, true);
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = isSignupMode ? 'Sign Up' : 'Login';
            }
        });

        // Forgot password
        forgotPasswordLink.addEventListener('click', async function(e) {
            e.preventDefault();
            
            const email = emailInput.value.trim();
            if (!email) {
                showMessage('Please enter your email address first', true);
                return;
            }

            try {
                await auth.sendPasswordResetEmail(email);
                showMessage('Password reset email sent!');
            } catch (error) {
                showMessage('Error sending reset email', true);
            }
        });

        // Google sign in
        googleLoginBtn.addEventListener('click', async function() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            try {
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                // Store/update user data in Firestore
                await firebase.firestore().collection('users').doc(user.uid).set({
                    email: user.email,
                    displayName: user.displayName,
                    photoURL: user.photoURL,
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                showMessage('Login successful! Redirecting...');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            } catch (error) {
                console.error('Google sign-in error:', error);
                showMessage('Google sign-in failed', true);
            }
        });

        // Check if user is already logged in
        auth.onAuthStateChanged(function(user) {
            if (user) {
                // User is signed in, redirect to home page
                window.location.href = 'index.html';
            }
        });
    </script>
</body>
</html>
