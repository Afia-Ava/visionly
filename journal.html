<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visionly - Journal</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="journal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-storage-compat.js"></script>
    <style>
        /* Override any CSS that might be preventing scrolling */
        html, body {
            height: auto !important;
            overflow: visible !important;
            overflow-y: auto !important;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body style="font-family: 'Inter', sans-serif; background-color: #f9f9f9; color: #333; margin: 0; padding: 0;">
    <nav class="navbar" style="position: fixed; top: 0; width: 100%; background-color: #fff; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08); padding: 14px 30px; height: 70px; display: flex; align-items: center; justify-content: space-between; z-index: 1000; box-sizing: border-box;">
        <a href="index.html" class="logo" style="font-family: 'Dancing Script', cursive; font-weight: bold; font-size: 2rem; color: #333; text-decoration: none;">Visionly</a>
        <div style="display: flex; align-items: center;">
            <a href="index.html" style="text-decoration: none; color: #333; margin: 0 12px;">Home</a>
            <a href="create-board.html" style="text-decoration: none; color: #333; margin: 0 12px;">Create</a>
            <a href="boards.html" style="text-decoration: none; color: #333; margin: 0 12px;">Boards</a>
            <a href="progress.html" style="text-decoration: none; color: #333; margin: 0 12px;">Progress</a>
            <a href="journal.html" style="text-decoration: none; color: #333; margin: 0 12px; margin-right: 15px;">Journal</a>
            <img id="profile-photo" src="https://via.placeholder.com/40x40/ff6b6b/ffffff?text=U" alt="Profile" style="width: 38px; height: 38px; border-radius: 50%; cursor: pointer;">
        </div>
    </nav>

    <div id="navbar-container"></div>
    
    <!-- Centered Header -->
    <div style="text-align: center; margin-top: 100px; margin-bottom: 40px;">
        <h1 style="font-size: 2rem; font-weight: bold; color: #333; margin-bottom: 5px;">Journal Entry</h1>
        <p style="color: #666; margin-top: 0; margin-bottom: 0;">A canvas for your thoughts and intentions</p>
    </div>
    
    <main style="display: flex; max-width: 1200px; margin: 0 auto; padding: 20px; gap: 20px; padding-bottom: 100px;">
        <!-- Left Sidebar with Calendar and Previous Entries -->
        <div style="flex: 0 0 280px; background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <!-- Calendar Section -->
            <div style="margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <button id="prev-month" style="background: none; border: none; font-size: 18px; cursor: pointer;">â€¹</button>
                    <h3 id="month-year" style="margin: 0; font-size: 16px; font-weight: 600;">June 2025</h3>
                    <button id="next-month" style="background: none; border: none; font-size: 18px; cursor: pointer;">â€º</button>
                </div>
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; font-size: 12px;">
                    <div style="text-align: center; padding: 5px; font-weight: 600; color: #666;">S</div>
                    <div style="text-align: center; padding: 5px; font-weight: 600; color: #666;">M</div>
                    <div style="text-align: center; padding: 5px; font-weight: 600, color: #666;">T</div>
                    <div style="text-align: center; padding: 5px; font-weight: 600, color: #666;">W</div>
                    <div style="text-align: center; padding: 5px; font-weight: 600, color: #666;">T</div>
                    <div style="text-align: center; padding: 5px; font-weight: 600, color: #666;">F</div>
                    <div style="text-align: center; padding: 5px; font-weight: 600, color: #666;">S</div>
                </div>
                <div id="calendar-days" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-top: 5px;">
                    <!-- Calendar days will be generated by JavaScript -->
                </div>
            </div>
            
            <!-- Previous Entries -->
            <div>
                <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600;">Previous Entries</h3>
                <div id="entries-list" style="display: flex; flex-direction: column; gap: 8px;">
                    <div style="padding: 15px; text-align: center; color: #666; font-style: italic; font-size: 14px;">
                        You do not have any journal yet. Write your first journal!
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div style="flex: 1; display: flex; flex-direction: column; gap: 20px;">
            <!-- Header with Entry Actions -->
            <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; gap: 10px;">
                    <button style="background: #2d1a45; color: white; border: none; border-radius: 8px; padding: 10px 16px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                        Get Prompt
                    </button>
                    <button style="background: #2d1a45; color: white; border: none; border-radius: 8px; padding: 10px 16px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                        New Entry
                    </button>
                </div>
            </div>

            <!-- Entry Content -->
            <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; flex-direction: column;">
                <!-- Entry Title and Mood in one row -->
                <div style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center;">
                    <input type="text" placeholder="Entry Title" style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; font-weight: 500;">
                    
                    <!-- Compact Mood Section -->
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-weight: 500; color: #666; font-size: 14px;">Mood:</label>
                        <div style="display: flex; gap: 5px;">
                            <button class="mood-btn" data-mood="ðŸ˜Š" style="width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 6px; background: white; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center;">ðŸ˜Š</button>
                            <button class="mood-btn" data-mood="ðŸ˜Œ" style="width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 6px; background: white; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center;">ðŸ˜Œ</button>
                            <button class="mood-btn" data-mood="ðŸ¤”" style="width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 6px; background: white; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center;">ðŸ¤”</button>
                            <button class="mood-btn" data-mood="ðŸ˜”" style="width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 6px; background: white; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center;">ðŸ˜”</button>
                            <button class="mood-btn" data-mood="ðŸ˜¤" style="width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 6px; background: white; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center;">ðŸ˜¤</button>
                        </div>
                    </div>
                </div>

                <textarea placeholder="Write your journal entry here..." style="width: 100%; height: 400px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; line-height: 1.6; resize: vertical; font-family: 'Inter', sans-serif; box-sizing: border-box;"></textarea>
                
                <!-- Footer with Save Status -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                    <span style="color: #666; font-size: 14px;">All changes saved</span>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button style="background: #dc3545; color: white; border: none; border-radius: 6px; padding: 8px 12px; font-size: 14px; cursor: pointer;">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Background Sound -->
    <audio id="background-sound" loop>
        <source src="assets/relaxing-nature-sound.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Toggle Sound Button -->
    <button id="toggle-sound" style="position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #2d1a45; border: none; cursor: pointer; box-shadow: 0 4px 12px rgba(45, 26, 69, 0.3); display: flex; align-items: center; justify-content: center; z-index: 1000; transition: transform 0.2s ease;">
        <img src="assets/speaker-on-icon.png" alt="Sound On" id="sound-icon" style="width: 20px; height: 20px; filter: brightness(0) invert(1);">
    </button>

    <script src="firebase-config.js"></script>
    <script src="nav-auth.js"></script>
    <script src="journal.js"></script>
    <script src="global-sound.js"></script>
    <script src="shared-scripts.js"></script>
    <script src="profile-dropdown.js"></script>
    <script>
        // Calendar functionality
        document.addEventListener('DOMContentLoaded', function() {
            const monthYear = document.getElementById('month-year');
            const calendarDays = document.getElementById('calendar-days');
            const prevMonth = document.getElementById('prev-month');
            const nextMonth = document.getElementById('next-month');
            
            let currentDate = new Date();
            
            function generateCalendar(year, month) {
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());
                
                const monthNames = ["January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"];
                
                monthYear.textContent = `${monthNames[month]} ${year}`;
                calendarDays.innerHTML = '';
                
                const today = new Date();
                const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
                const currentDate = today.getDate();
                
                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    
                    const dayElement = document.createElement('div');
                    dayElement.textContent = date.getDate();
                    
                    // Check if this is today's date
                    const isToday = isCurrentMonth && date.getDate() === currentDate && date.getMonth() === month;
                    
                    dayElement.style.cssText = `
                        text-align: center; 
                        padding: 8px; 
                        cursor: pointer; 
                        border-radius: 4px;
                        font-size: 14px;
                        ${date.getMonth() === month ? 'color: #333;' : 'color: #ccc;'}
                        ${isToday ? 'background: #2d1a45; color: white; font-weight: 600;' : ''}
                    `;
                    
                    dayElement.addEventListener('click', function() {
                        document.querySelectorAll('#calendar-days div').forEach(d => {
                            d.style.background = '';
                            d.style.color = d.style.color.includes('#ccc') ? '#ccc' : '#333';
                            d.style.fontWeight = '';
                        });
                        this.style.background = '#2d1a45';
                        this.style.color = 'white';
                        this.style.fontWeight = '600';
                    });
                    
                    calendarDays.appendChild(dayElement);
                }
            }
            
            prevMonth.addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            });
            
            nextMonth.addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
            });
            
            // Mood selection functionality
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.mood-btn').forEach(b => {
                        b.style.borderColor = '#ddd';
                        b.style.background = 'white';
                    });
                    this.style.borderColor = '#2d1a45';
                    this.style.background = '#f3f0ff';
                });
            });
            
            // New Entry functionality
            const buttons = document.querySelectorAll('button');
            let newEntryBtn = null;
            
            // Find the "New Entry" button by its text content
            buttons.forEach(btn => {
                if (btn.textContent.trim() === 'New Entry') {
                    newEntryBtn = btn;
                }
            });
            
            const entryTitle = document.querySelector('input[placeholder="Entry Title"]');
            const entryTextarea = document.querySelector('textarea');
            const entriesList = document.getElementById('entries-list');
            
            if (newEntryBtn) {
                newEntryBtn.addEventListener('click', function() {
                    // Save current entry if there's content
                    const title = entryTitle.value.trim();
                    const content = entryTextarea.value.trim();
                    const selectedMood = document.querySelector('.mood-btn[style*="#2d1a45"]');
                    
                    if (title || content) {
                        // Remove "no entries" message if it exists
                        const noEntriesMessage = entriesList.querySelector('div[style*="font-style: italic"]');
                        if (noEntriesMessage) {
                            noEntriesMessage.remove();
                        }
                        
                        // Create entry element
                        const entryElement = document.createElement('div');
                        entryElement.style.cssText = 'padding: 10px; background: #f8f9fa; border-radius: 8px; cursor: pointer; border-left: 3px solid #2d1a45; position: relative;';
                        
                        const entryTitleDiv = document.createElement('div');
                        entryTitleDiv.style.cssText = 'font-weight: 500; font-size: 14px; margin-bottom: 4px;';
                        entryTitleDiv.textContent = title || 'Untitled Entry';
                        
                        const entryDate = document.createElement('div');
                        entryDate.style.cssText = 'font-size: 12px; color: #666;';
                        const now = new Date();
                        entryDate.textContent = now.toLocaleDateString();
                        
                        if (selectedMood) {
                            const moodSpan = document.createElement('span');
                            moodSpan.style.cssText = 'margin-left: 8px; font-size: 14px;';
                            moodSpan.textContent = selectedMood.getAttribute('data-mood');
                            entryDate.appendChild(moodSpan);
                        }
                        
                        // Create delete button
                        const deleteBtn = document.createElement('button');
                        deleteBtn.innerHTML = 'Ã—';
                        deleteBtn.style.cssText = 'position: absolute; top: 5px; right: 5px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; cursor: pointer; display: none; line-height: 1;';
                        
                        // Show/hide delete button on hover
                        entryElement.addEventListener('mouseenter', function() {
                            deleteBtn.style.display = 'block';
                        });
                        
                        entryElement.addEventListener('mouseleave', function() {
                            deleteBtn.style.display = 'none';
                        });
                        
                        // Delete functionality
                        deleteBtn.addEventListener('click', function(e) {
                            e.stopPropagation(); // Prevent entry selection
                            if (confirm('Are you sure you want to delete this entry?')) {
                                entryElement.remove();
                                
                                // If no entries left, show the "no entries" message
                                if (entriesList.children.length === 0) {
                                    const noEntriesDiv = document.createElement('div');
                                    noEntriesDiv.style.cssText = 'padding: 15px; text-align: center; color: #666; font-style: italic; font-size: 14px;';
                                    noEntriesDiv.textContent = 'You do not have any journal yet. Write your first journal!';
                                    entriesList.appendChild(noEntriesDiv);
                                }
                            }
                        });
                        
                        entryElement.appendChild(entryTitleDiv);
                        entryElement.appendChild(entryDate);
                        entryElement.appendChild(deleteBtn);
                        
                        // Store entry data
                        entryElement.dataset.title = title;
                        entryElement.dataset.content = content;
                        entryElement.dataset.mood = selectedMood ? selectedMood.getAttribute('data-mood') : '';
                        
                        // Add click handler to load entry
                        entryElement.addEventListener('click', function() {
                            entryTitle.value = this.dataset.title;
                            entryTextarea.value = this.dataset.content;
                            
                            // Reset mood selection
                            document.querySelectorAll('.mood-btn').forEach(b => {
                                b.style.borderColor = '#ddd';
                                b.style.background = 'white';
                            });
                            
                            // Select the saved mood
                            if (this.dataset.mood) {
                                const moodBtn = document.querySelector(`[data-mood="${this.dataset.mood}"]`);
                                if (moodBtn) {
                                    moodBtn.style.borderColor = '#2d1a45';
                                    moodBtn.style.background = '#f3f0ff';
                                }
                            }
                            
                            // Update border for selected entry
                            document.querySelectorAll('#entries-list > div').forEach(d => {
                                d.style.borderLeft = '3px solid transparent';
                            });
                            this.style.borderLeft = '3px solid #2d1a45';
                        });
                        
                        // Add to entries list at the top
                        entriesList.insertBefore(entryElement, entriesList.firstChild);
                    }
                    
                    // Clear form for new entry
                    entryTitle.value = '';
                    entryTextarea.value = '';
                    
                    // Reset mood selection
                    document.querySelectorAll('.mood-btn').forEach(b => {
                        b.style.borderColor = '#ddd';
                        b.style.background = 'white';
                    });
                    
                    // Reset entry selection
                    document.querySelectorAll('#entries-list > div').forEach(d => {
                        if (d.style.borderLeft) {
                            d.style.borderLeft = '3px solid transparent';
                        }
                    });
                    
                    // Focus on title input
                    entryTitle.focus();
                });
            }
            
            generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
        });
        
        // Debug scrolling issue
        document.addEventListener('DOMContentLoaded', function() {
            // Check if there are any CSS rules preventing scrolling
            console.log('Body height:', document.body.scrollHeight);
            console.log('Window height:', window.innerHeight);
            console.log('Document height:', document.documentElement.scrollHeight);
            
            // Force enable scrolling
            document.body.style.overflow = 'visible';
            document.documentElement.style.overflow = 'visible';
            document.body.style.height = 'auto';
            document.documentElement.style.height = 'auto';
        });
    </script>
</body>
</html>